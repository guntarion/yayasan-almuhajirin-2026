# Fixing CVE-2025-55182 (React2Shell) Vulnerability in Next.js

## Background

### What is CVE-2025-55182?

CVE-2025-55182, also known as **React2Shell**, is a **critical-severity Remote Code Execution (RCE)** vulnerability discovered in React Server Components. The vulnerability was publicly disclosed on December 4, 2025, with exploits becoming available in the wild.

### How It Works

Under certain conditions, specially crafted requests to applications using React Server Components can lead to unintended remote code execution on the server. This means attackers could potentially:

- Execute arbitrary code on your server
- Access sensitive data and environment variables
- Compromise your entire application infrastructure

### Affected Packages

The vulnerability affects these React packages in versions 19.0.0, 19.1.0, 19.1.1, and 19.2.0:

- `react-server-dom-parcel`
- `react-server-dom-webpack`
- `react-server-dom-turbopack`

### Affected Next.js Versions

| Version Range | Vulnerable | Fixed Version |
|---------------|------------|---------------|
| 14.3.0-canary.77+ | Yes | Downgrade to stable 14.x |
| 15.0.x | Yes | 15.0.5 or 15.0.7 |
| 15.1.x | Yes | 15.1.9 or 15.1.11 |
| 15.2.x | Yes | 15.2.6 or 15.2.8 |
| 15.3.x | Yes | 15.3.6 or 15.3.8 |
| 15.4.x | Yes | 15.4.8 or 15.4.10 |
| 15.5.x | Yes | 15.5.7+ (recommend 15.5.9+) |
| 16.0.x | Yes | 16.0.7 or 16.0.10 |

---

## Diagnosis

### Step 1: Check Your Next.js Version

Run the following command in your project root:

```bash
npm ls next
```

Example output showing a vulnerable version:

```
└── next@15.5.6
```

### Step 2: Determine If You're Affected

You are affected if:

1. You're using Next.js version ≥14.3.0-canary.77, or any version in 15.x or 16.x before the patched versions listed above
2. Your application uses React Server Components (the default in Next.js App Router)

### Step 3: Check for Deprecation Warnings

When installing or updating packages, npm will show a warning for vulnerable versions:

```
npm warn deprecated next@15.5.6: This version has a security vulnerability.
Please upgrade to a patched version.
See https://nextjs.org/blog/security-update-2025-12-11 for more details.
```

---

## Fix Options

### Option 1: Automatic Fix (Recommended)

Run the official fix tool:

```bash
npx fix-react2shell-next
```

This tool will automatically scan your project and update vulnerable packages to patched versions.

### Option 2: Manual Update

Update Next.js to the latest patched version for your major.minor version:

```bash
# For 15.5.x projects
npm install next@15.5.9

# For 15.4.x projects
npm install next@15.4.10

# For 15.3.x projects
npm install next@15.3.8

# For 15.2.x projects
npm install next@15.2.8

# For 15.1.x projects
npm install next@15.1.11

# For 15.0.x projects
npm install next@15.0.7

# For 16.x projects
npm install next@16.0.10

# Or update to latest stable
npm install next@latest
```

### Option 3: Check Available Versions

To see all available patched versions:

```bash
# Check dist-tags for recommended versions
npm view next dist-tags --json

# Check all versions in your minor release
npm view next versions --json | grep '"15\.5\.'
```

---

## Verification

### Step 1: Verify the Update

After updating, verify the new version:

```bash
npm ls next
```

Expected output (example for 15.5.9):

```
└── next@15.5.9
```

### Step 2: Check for Deprecation Warnings

The deprecation warning should no longer appear when running npm commands.

### Step 3: Run Type Check

Ensure the update doesn't break your build:

```bash
npm run type-check
# or
npx tsc --noEmit
```

### Step 4: Test Build

Run a production build to ensure everything works:

```bash
npm run build
```

---

## Post-Fix Actions (Critical)

### Rotate All Secrets

**Important:** Vercel advises that vulnerable systems should be considered potentially compromised. You should:

1. **Rotate NEXTAUTH_SECRET**
   ```bash
   # Generate a new secret
   openssl rand -base64 32
   ```
   Update in your `.env` files and hosting provider's environment variables.

2. **Rotate API Keys**
   - Database connection strings
   - Third-party API keys (Anthropic, OpenAI, Google, etc.)
   - OAuth client secrets (Google, GitHub, etc.)
   - AWS/Cloud storage credentials

3. **Rotate Session/JWT Secrets**
   - Any custom session secrets
   - JWT signing keys

4. **Review Access Logs**
   - Check server logs for suspicious activity
   - Review authentication logs
   - Monitor for unusual API calls

---

## Additional Protections

### Enable WAF Protection

If using Vercel:
- Vercel has deployed WAF rules to protect hosted projects
- Enable Standard Protection for non-production deployments
- Note: WAF rules cannot guarantee protection against all variants

### Update React Packages

If you're also directly using React 19, update to patched versions:

- React 19.0.1
- React 19.1.2
- React 19.2.1

```bash
npm install react@19.2.1 react-dom@19.2.1
```

---

## Claude Code Quick Reference

When using Claude Code to fix this vulnerability in any Next.js project, use these commands:

```
# 1. Check current version
npm ls next

# 2. Update to patched version (adjust version as needed)
npm install next@15.5.9

# 3. Verify no deprecation warning and check types
npm run type-check

# 4. Commit the fix
git add package.json package-lock.json
git commit -m "security: Update Next.js to fix CVE-2025-55182 (React2Shell)"
git push
```

---

## References

- [Vercel CVE-2025-55182 Changelog](https://vercel.com/changelog/cve-2025-55182)
- [Vercel React2Shell Security Bulletin](https://vercel.com/kb/bulletin/react2shell)
- [Next.js Security Update Blog](https://nextjs.org/blog/security-update-2025-12-11)

---

## Document History

| Date | Version | Author | Changes |
|------|---------|--------|---------|
| 2025-12-14 | 1.0 | Claude Code | Initial documentation |
